define(["modules/jquery-mozu","hyprlive","shim!vendor/underscore>_","modules/api","modules/backbone-mozu","modules/models-product"],function(e,t,o,r,i,n){function s(){return(e.cookie("mozustocknotify")||"").split(",")}function d(t){var o=s();e.cookie("mozustocknotify",o.concat(t).join(","),{path:"/",expires:365})}var u=require.mozuData("user"),a=i.MozuView.extend({templateName:"modules/product/product-instock-request",clearError:function(){this.setError("")},setError:function(e){this.$("[data-mz-validationmessage-for]").text(e)},getRenderContext:function(){var e=i.MozuView.prototype.getRenderContext.apply(this,arguments);return e.subscribed=-1!==o.indexOf(s(),this.model.get("variationProductCode")||this.model.get("productCode")),e},render:function(){i.MozuView.prototype.render.apply(this,arguments),this.$(".mz-instock-request").css("display","inherit")},widgetNotifyUserAction:function(){var e=this;this.clearError();var o=this.$('[data-mz-role="email"]').val()||u.email;return o?(r.create("instockrequest",{email:o,customerId:u.accountId,productCode:this.model.get("productCode"),locationCode:this.model.get("inventoryInfo").onlineLocationCode}).then(function(){d(e.model.get("variationProductCode")||e.model.get("productCode")),e.render()},function(){e.setError(t.getLabel("notifyWidgetError"))}),void 0):(this.setError(t.getLabel("emailMissing")),!1)}});e(document).ready(function(){var t=n.Product.fromCurrent(),o=t.get("inventoryInfo"),r=new a({model:t,el:e(".mz-instock-request").first().parent()});o&&o.onlineStockAvailable<1||e("body").hasClass("mz-cms-editing")?r.render():r.$(".mz-instock-request").remove()})});